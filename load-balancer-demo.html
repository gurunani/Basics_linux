<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Balancer Sharing Process</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .method-selector {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .method-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .method-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .method-btn.active {
            background: linear-gradient(45deg, #2c3e50, #3498db);
        }
        
        .demo-area {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .users-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        
        .nginx-section {
            background: #fff5f5;
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #e74c3c;
            text-align: center;
        }
        
        .servers-section {
            background: #f0fff4;
            padding: 20px;
            border-radius: 12px;
            border-right: 5px solid #27ae60;
        }
        
        .user {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        
        .user.active {
            opacity: 1;
            transform: scale(1.05);
            animation: pulse 1s infinite;
        }
        
        .server {
            background: #27ae60;
            color: white;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .server.processing {
            background: #f39c12;
            animation: glow 1s infinite;
        }
        
        .server-load {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .nginx-brain {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-weight: bold;
            position: relative;
        }
        
        .nginx-brain.thinking {
            animation: spin 2s infinite;
        }
        
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1.05); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px #f39c12; }
            50% { box-shadow: 0 0 20px #f39c12, 0 0 30px #f39c12; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üîÑ Load Balancer Sharing Process</h1>
        
        <div class="method-selector">
            <button class="method-btn active" data-method="round-robin">Round Robin</button>
            <button class="method-btn" data-method="weighted">Weighted</button>
            <button class="method-btn" data-method="least-conn">Least Connections</button>
        </div>
        
        <div class="demo-area">
            <div class="users-section">
                <h3>üë• Users Making Requests</h3>
                <div id="users">
                    <div class="user" data-user="1">User 1: View Products</div>
                    <div class="user" data-user="2">User 2: Add to Cart</div>
                    <div class="user" data-user="3">User 3: Login</div>
                    <div class="user" data-user="4">User 4: Search Items</div>
                    <div class="user" data-user="5">User 5: Checkout</div>
                    <div class="user" data-user="6">User 6: View Orders</div>
                    <div class="user" data-user="7">User 7: Browse Categories</div>
                    <div class="user" data-user="8">User 8: Update Profile</div>
                </div>
            </div>
            
            <div class="nginx-section">
                <div class="nginx-brain" id="nginx-brain">
                    nginx
                    <br>Load<br>Balancer
                </div>
                <div>üß† Deciding which server gets the request...</div>
            </div>
            
            <div class="servers-section">
                <h3>üñ•Ô∏è Backend Servers</h3>
                <div id="servers">
                    <div class="server" data-server="1">
                        Server A (catalogue1.gurulabs.xyz)
                        <div class="server-load">Load: <span class="load-count">0</span></div>
                    </div>
                    <div class="server" data-server="2">
                        Server B (catalogue2.gurulabs.xyz)
                        <div class="server-load">Load: <span class="load-count">0</span></div>
                    </div>
                    <div class="server" data-server="3">
                        Server C (catalogue3.gurulabs.xyz)
                        <div class="server-load">Load: <span class="load-count">0</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="start-btn" id="start-demo">üöÄ Start Load Balancing Demo</button>
        </div>
        
        <div class="log" id="log">
            <div>üîÑ Load Balancer Ready - Click "Start Demo" to see requests being distributed...</div>
        </div>
    </div>

    <script>
        let currentMethod = 'round-robin';
        let serverLoads = [0, 0, 0];
        let roundRobinIndex = 0;
        let serverWeights = [3, 2, 1]; // Server A=3, B=2, C=1
        let weightCounter = 0;
        let isRunning = false;
        
        // Method selection
        document.querySelectorAll('.method-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMethod = btn.dataset.method;
                resetDemo();
            });
        });
        
        // Reset demo
        function resetDemo() {
            serverLoads = [0, 0, 0];
            roundRobinIndex = 0;
            weightCounter = 0;
            updateServerLoads();
            document.getElementById('log').innerHTML = '<div>üîÑ Load Balancer Ready - Method: ' + currentMethod + '</div>';
        }
        
        // Update server load display
        function updateServerLoads() {
            document.querySelectorAll('.server .load-count').forEach((elem, index) => {
                elem.textContent = serverLoads[index];
            });
        }
        
        // Log function
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + message + '</div>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Select server based on method
        function selectServer() {
            let selectedServer;
            
            switch(currentMethod) {
                case 'round-robin':
                    selectedServer = roundRobinIndex;
                    roundRobinIndex = (roundRobinIndex + 1) % 3;
                    break;
                    
                case 'weighted':
                    // Weighted round robin implementation
                    let totalWeight = serverWeights.reduce((a, b) => a + b, 0);
                    let currentPos = weightCounter % totalWeight;
                    
                    let cumulative = 0;
                    for (let i = 0; i < serverWeights.length; i++) {
                        cumulative += serverWeights[i];
                        if (currentPos < cumulative) {
                            selectedServer = i;
                            break;
                        }
                    }
                    weightCounter++;
                    break;
                    
                case 'least-conn':
                    // Find server with least connections
                    selectedServer = serverLoads.indexOf(Math.min(...serverLoads));
                    break;
            }
            
            return selectedServer;
        }
        
        // Animate request processing
        async function processRequest(userIndex) {
            const user = document.querySelector(`[data-user="${userIndex}"]`);
            const nginx = document.getElementById('nginx-brain');
            
            // Highlight user
            user.classList.add('active');
            nginx.classList.add('thinking');
            
            await delay(500);
            
            // Select server
            const serverIndex = selectServer();
            const server = document.querySelector(`[data-server="${serverIndex + 1}"]`);
            
            // Log the decision
            const serverNames = ['Server A', 'Server B', 'Server C'];
            log(`üë§ User ${userIndex} ‚Üí üß† nginx ‚Üí üñ•Ô∏è ${serverNames[serverIndex]} (${currentMethod})`);
            
            // Highlight selected server
            server.classList.add('processing');
            serverLoads[serverIndex]++;
            updateServerLoads();
            
            await delay(1000);
            
            // Reset highlights
            user.classList.remove('active');
            nginx.classList.remove('thinking');
            server.classList.remove('processing');
            
            // Simulate request completion
            await delay(1000);
            serverLoads[serverIndex] = Math.max(0, serverLoads[serverIndex] - 1);
            updateServerLoads();
        }
        
        // Delay utility
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Start demo
        document.getElementById('start-demo').addEventListener('click', async () => {
            if (isRunning) return;
            
            isRunning = true;
            const btn = document.getElementById('start-demo');
            btn.textContent = '‚è≥ Running Demo...';
            btn.disabled = true;
            
            resetDemo();
            log(`üöÄ Starting ${currentMethod} load balancing demo...`);
            
            // Process 8 users with random delays
            for (let i = 1; i <= 8; i++) {
                setTimeout(() => processRequest(i), (i - 1) * 800);
            }
            
            // Reset button after demo
            setTimeout(() => {
                btn.textContent = 'üöÄ Start Load Balancing Demo';
                btn.disabled = false;
                isRunning = false;
                log('‚úÖ Demo completed! Try different methods above.');
            }, 8000);
        });
        
        // Initialize
        resetDemo();
    </script>
</body>
</html>